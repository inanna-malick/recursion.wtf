{{- $persona := .Get "persona" -}}
{{- $lens := .Get "lens" -}}
{{- $type := .Get "type" -}}
{{- $emphasis := .Get "emphasis" | default "normal" -}}
{{- $bridge := .Get "bridge" -}}
{{- $brief := .Get "brief" | default false -}}

{{- if not $persona -}}
  {{- errorf "The %q shortcode requires a 'persona' parameter: see %s" .Name .Position -}}
{{- end -}}

{{- $classes := printf "stance stance-%s" $emphasis -}}
{{- if $brief -}}
  {{- $classes = printf "%s stance-brief" $classes -}}
{{- end -}}

<aside class="{{ $classes }}" role="complementary" aria-labelledby="stance-{{ .Ordinal }}">
  <div class="stance-header">
    <h4 id="stance-{{ .Ordinal }}" class="stance-persona">
      <strong>{{ $persona }}</strong>{{- if $lens }}, {{ $lens }}{{ end }}
    </h4>
  </div>
  
  {{- if .Inner -}}
  <div class="stance-content">
    {{ .Inner | .Page.RenderString }}
  </div>
  {{- end -}}
  
  {{- if $bridge -}}
  <div class="stance-bridge">
    <span class="bridge-text">{{ $bridge }}</span>
  </div>
  {{- end -}}
</aside>